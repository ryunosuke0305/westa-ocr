<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>westa-ocr 管理コンソール</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
  <style>
    body {
      background-color: #f8f9fa;
    }
    pre {
      white-space: pre-wrap;
      word-break: break-word;
    }
    .form-text-small {
      font-size: 0.85rem;
    }
  </style>
</head>
<body class="bg-light">
  <div id="app" class="container py-4">
    <header class="mb-4">
      <h1 class="h3 mb-1">westa-ocr 管理コンソール</h1>
      <p class="text-muted mb-0">
        Gemini への手動リクエスト、Webhook の送信、環境変数の管理を行うツールです。
      </p>
    </header>

    <section v-if="state.messages.length" class="mb-4">
      <div class="card shadow-sm">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
          <h2 class="h5 mb-0">通知</h2>
          <button
            type="button"
            class="btn btn-sm btn-outline-secondary"
            @click="ui.messagesExpanded = !ui.messagesExpanded"
          >
            [[ ui.messagesExpanded ? '非表示' : '表示' ]]
          </button>
        </div>
        <div class="card-body" v-show="ui.messagesExpanded">
          <div
            v-for="(message, index) in state.messages"
            :key="`message-${index}`"
            :class="[
              'alert',
              message.success ? 'alert-success' : 'alert-danger',
              index === state.messages.length - 1 ? 'mb-0' : 'mb-3',
            ]"
            role="alert"
          >
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <span class="badge text-bg-secondary text-uppercase mb-2">[[ message.category ]]</span>
                <h3 class="h6 mb-1">[[ message.summary ]]</h3>
                <p class="mb-0" v-if="message.detail">[[ message.detail ]]</p>
              </div>
              <small class="text-muted ms-3">[[ message.timestamp ]]</small>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div class="row g-4">
      <div class="col-lg-5">
        <section class="card shadow-sm h-100">
          <div class="card-header bg-white">
            <h2 class="h5 mb-0">環境変数の更新</h2>
          </div>
          <div class="card-body">
            <p class="text-muted form-text-small">
              空欄にすると既定値が利用されます。Relay Token は必須です。
            </p>
            <form method="post" action="/admin/settings">
              <div class="row g-3">
                <div
                  class="col-12"
                  v-for="field in state.configFields"
                  :key="field.env"
                >
                  <label :for="`settings-${field.env}`" class="form-label">[[ field.label ]]</label>
                  <input
                    class="form-control"
                    :type="field.type"
                    :id="`settings-${field.env}`"
                    :name="field.env"
                    :placeholder="field.placeholder"
                    v-model="forms.settings[field.env]"
                    autocomplete="off"
                  />
                </div>
              </div>
              <div class="d-flex justify-content-end mt-3">
                <button type="submit" class="btn btn-primary">保存して再読み込み</button>
              </div>
            </form>
          </div>
        </section>
      </div>
      <div class="col-lg-7">
        <section class="card shadow-sm mb-4">
          <div class="card-header bg-white">
            <h2 class="h5 mb-0">Gemini へ手動リクエスト</h2>
          </div>
          <div class="card-body">
            <form method="post" action="/admin/gemini" enctype="multipart/form-data">
              <div class="mb-3">
                <label for="gemini-prompt" class="form-label">プロンプト</label>
                <textarea
                  id="gemini-prompt"
                  name="prompt"
                  class="form-control"
                  rows="4"
                  required
                  v-model="forms.gemini.prompt"
                  placeholder="例: 添付の発注書から取引先名と合計金額を抽出してください"
                ></textarea>
              </div>
              <div class="mb-3">
                <label for="gemini-pdf" class="form-label">PDF ファイル</label>
                <input
                  id="gemini-pdf"
                  name="pdf_file"
                  type="file"
                  class="form-control"
                  accept="application/pdf"
                  required
                />
                <div class="form-text">Gemini に送信する PDF ファイルをアップロードしてください。</div>
              </div>
              <div class="mb-3">
                <label for="gemini-masters" class="form-label">マスター情報(JSON)</label>
                <textarea
                  id="gemini-masters"
                  name="masters"
                  class="form-control"
                  rows="4"
                  v-model="forms.gemini.masters"
                  placeholder='例: {"shipCsv": "https://...", "itemCsv": "https://..."}'
                ></textarea>
              </div>
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="gemini-model" class="form-label">モデル</label>
                  <input
                    id="gemini-model"
                    name="model"
                    type="text"
                    class="form-control"
                    :placeholder="`既定値: ${state.defaults.geminiModel}`"
                    v-model="forms.gemini.model"
                  />
                </div>
                <div class="col-md-6">
                  <label for="gemini-temperature" class="form-label">Temperature</label>
                  <input
                    id="gemini-temperature"
                    name="temperature"
                    type="text"
                    class="form-control"
                    v-model="forms.gemini.temperature"
                    :placeholder="`既定値: ${state.defaults.geminiTemperature}`"
                  />
                </div>
                <div class="col-md-4">
                  <label for="gemini-top-p" class="form-label">Top P</label>
                  <input
                    id="gemini-top-p"
                    name="top_p"
                    type="text"
                    class="form-control"
                    v-model="forms.gemini.topP"
                    :placeholder="`既定値: ${state.defaults.geminiTopP}`"
                  />
                </div>
                <div class="col-md-4">
                  <label for="gemini-top-k" class="form-label">Top K</label>
                  <input
                    id="gemini-top-k"
                    name="top_k"
                    type="text"
                    class="form-control"
                    v-model="forms.gemini.topK"
                    placeholder="例: 40"
                  />
                </div>
                <div class="col-md-4">
                  <label for="gemini-max-output" class="form-label">最大出力トークン</label>
                  <input
                    id="gemini-max-output"
                    name="max_output_tokens"
                    type="text"
                    class="form-control"
                    v-model="forms.gemini.maxOutputTokens"
                    placeholder="例: 8192"
                  />
                </div>
              </div>
              <div class="d-flex justify-content-end mt-3">
                <button type="submit" class="btn btn-primary">Gemini へ送信</button>
              </div>
            </form>
          </div>
        </section>

        <section class="card shadow-sm">
          <div class="card-header bg-white">
            <h2 class="h5 mb-0">Webhook を手動送信</h2>
          </div>
          <div class="card-body">
            <form method="post" action="/admin/webhook">
              <div class="mb-3">
                <label for="webhook-url" class="form-label">URL</label>
                <input
                  id="webhook-url"
                  name="url"
                  type="url"
                  class="form-control"
                  required
                  v-model="forms.webhook.url"
                  placeholder="例: https://example.com/webhook"
                />
              </div>
              <div class="mb-3">
                <label for="webhook-token" class="form-label">Bearer トークン</label>
                <input
                  id="webhook-token"
                  name="token"
                  type="text"
                  class="form-control"
                  v-model="forms.webhook.token"
                  placeholder="例: eyJhbGciOi..."
                />
                <div class="form-text">指定すると Authorization: Bearer ... ヘッダを付与します。</div>
              </div>
              <div class="mb-3">
                <label for="webhook-payload" class="form-label">JSON ペイロード</label>
                <textarea
                  id="webhook-payload"
                  name="payload"
                  class="form-control"
                  rows="5"
                  required
                  v-model="forms.webhook.payload"
                  placeholder='例: {"event":"JOB_SUMMARY","jobId":"..."}'
                ></textarea>
              </div>
              <div class="d-flex justify-content-end">
                <button type="submit" class="btn btn-primary">Webhook を送信</button>
              </div>
            </form>
          </div>
        </section>
      </div>
    </div>

    <section class="card shadow-sm mt-4">
      <div class="card-header bg-white d-flex justify-content-between align-items-center">
        <h2 class="h5 mb-0">ジョブ状況</h2>
        <span class="text-muted small">1ページあたり [[ state.jobsPagination.pageSize ]] 件</span>
      </div>
      <div class="card-body">
        <p class="text-muted mb-0" v-if="!state.jobs.length">ジョブ履歴はまだありません。</p>
        <div class="accordion" id="jobsAccordion" v-else>
          <div
            class="accordion-item"
            v-for="(job, index) in state.jobs"
            :key="`job-${job.jobId}-${index}`"
          >
            <h2 class="accordion-header" :id="`job-heading-${index}`">
              <button
                class="accordion-button collapsed"
                type="button"
                data-bs-toggle="collapse"
                :data-bs-target="`#job-body-${index}`"
                aria-expanded="false"
                :aria-controls="`job-body-${index}`"
              >
                <span class="badge text-bg-secondary me-3">[[ job.statusLabel ]]</span>
                <span class="me-3 fw-semibold text-break">Job [[ job.jobId ]]</span>
                <span class="text-muted me-3 text-break">Order [[ job.orderId ]]</span>
                <span class="text-muted small ms-auto">更新 [[ job.updatedAt ]]</span>
              </button>
            </h2>
            <div
              :id="`job-body-${index}`"
              class="accordion-collapse collapse"
              :aria-labelledby="`job-heading-${index}`"
            >
              <div class="accordion-body">
                <dl class="row mb-0">
                  <dt class="col-sm-3">Job ID</dt>
                  <dd class="col-sm-9 text-break"><code>[[ job.jobId ]]</code></dd>
                  <dt class="col-sm-3">Order ID</dt>
                  <dd class="col-sm-9 text-break">[[ job.orderId ]]</dd>
                  <dt class="col-sm-3">ステータス</dt>
                  <dd class="col-sm-9"><span class="badge text-bg-secondary">[[ job.statusLabel ]]</span></dd>
                  <dt class="col-sm-3">担当ワーカー</dt>
                  <dd class="col-sm-9">[[ job.workerName || '-' ]]</dd>
                  <dt class="col-sm-3">ページ進捗</dt>
                  <dd class="col-sm-9">
                    [[ job.processedPages !== null && job.totalPages !== null
                      ? job.processedPages + ' / ' + job.totalPages + (job.skippedPages !== null ? ' (skip ' + job.skippedPages + ')' : '')
                      : '-' ]]
                  </dd>
                  <dt class="col-sm-3">作成日時</dt>
                  <dd class="col-sm-9">[[ job.createdAt ]]</dd>
                  <dt class="col-sm-3">更新日時</dt>
                  <dd class="col-sm-9">[[ job.updatedAt ]]</dd>
                  <dt class="col-sm-3">最終エラー</dt>
                  <dd class="col-sm-9 text-break">[[ job.lastError || '(なし)' ]]</dd>
                </dl>
                <div class="mt-3">
                  <form
                    v-if="job.canCancel"
                    method="post"
                    action="/admin/jobs/cancel"
                    class="d-inline"
                  >
                    <input type="hidden" name="job_id" :value="job.jobId" />
                    <button type="submit" class="btn btn-outline-danger btn-sm">中断</button>
                  </form>
                  <span v-else-if="job.cancellationRequested" class="badge text-bg-warning">中断要求中</span>
                  <span v-else class="text-muted">中断不可</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <nav
          v-if="state.jobsPagination.totalPages > 1"
          class="mt-3"
          aria-label="ジョブ履歴ページネーション"
        >
          <ul class="pagination pagination-sm mb-0">
            <li class="page-item" :class="{ disabled: !state.jobsPagination.hasPrev }">
              <a
                class="page-link"
                :href="state.jobsPagination.hasPrev ? jobPageLink(state.jobsPagination.page - 1) : '#'"
                aria-label="前のページ"
                :tabindex="state.jobsPagination.hasPrev ? null : -1"
              >
                前へ
              </a>
            </li>
            <li
              class="page-item"
              v-for="page in jobPageNumbers"
              :key="`job-page-${page}`"
              :class="{ active: page === state.jobsPagination.page }"
            >
              <a class="page-link" :href="jobPageLink(page)">[[ page ]]</a>
            </li>
            <li class="page-item" :class="{ disabled: !state.jobsPagination.hasNext }">
              <a
                class="page-link"
                :href="state.jobsPagination.hasNext ? jobPageLink(state.jobsPagination.page + 1) : '#'"
                aria-label="次のページ"
                :tabindex="state.jobsPagination.hasNext ? null : -1"
              >
                次へ
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </section>



    <section class="card shadow-sm mt-4">
      <div class="card-header bg-white d-flex justify-content-between align-items-center">
        <h2 class="h5 mb-0">ProcessOrder_test_relay リクエスト履歴</h2>
        <span class="text-muted small">最大 50 件を表示</span>
      </div>
      <div class="card-body">
        <p class="text-muted mb-0" v-if="!state.relayRequestLogs.length">履歴はまだありません。</p>
        <div class="accordion" id="relayRequestLogs" v-else>
          <div
            class="accordion-item"
            v-for="(log, index) in state.relayRequestLogs"
            :key="`relay-request-${index}`"
          >
            <h2 class="accordion-header" :id="`relay-request-heading-${index}`">
              <button
                class="accordion-button collapsed"
                type="button"
                data-bs-toggle="collapse"
                :data-bs-target="`#relay-request-body-${index}`"
                aria-expanded="false"
                :aria-controls="`relay-request-body-${index}`"
              >
                <span class="badge me-3" :class="log.status === 'ERROR' ? 'text-bg-danger' : 'text-bg-primary'">
                  [[ log.status ]]
                </span>
                <span class="me-3 fw-semibold text-break">Job [[ log.jobId ]]</span>
                <span class="me-3 text-muted text-break">Order [[ log.orderId ]]</span>
                <span class="text-muted small ms-auto">[[ log.timestamp ]]</span>
              </button>
            </h2>
            <div
              :id="`relay-request-body-${index}`"
              class="accordion-collapse collapse"
              :aria-labelledby="`relay-request-heading-${index}`"
              data-bs-parent="#relayRequestLogs"
            >
              <div class="accordion-body">
                <dl class="row mb-0">
                  <dt class="col-sm-3">Idempotency Key</dt>
                  <dd class="col-sm-9 text-break">[[ log.idempotencyKey ]]</dd>
                  <dt class="col-sm-3">メッセージ</dt>
                  <dd class="col-sm-9">[[ log.message || '(なし)' ]]</dd>
                  <dt class="col-sm-3">リクエスト</dt>
                  <dd class="col-sm-9"><pre class="bg-light p-3 rounded">[[ log.payload ]]</pre></dd>
                </dl>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="card shadow-sm mt-4">
      <div class="card-header bg-white d-flex justify-content-between align-items-center">
        <h2 class="h5 mb-0">自動 Webhook 送信履歴</h2>
        <span class="text-muted small">最大 50 件を表示</span>
      </div>
      <div class="card-body">
        <p class="text-muted mb-0" v-if="!state.relayWebhookLogs.length">履歴はまだありません。</p>
        <div class="accordion" id="relayWebhookLogs" v-else>
          <div
            class="accordion-item"
            v-for="(log, index) in state.relayWebhookLogs"
            :key="`relay-webhook-${index}`"
          >
            <h2 class="accordion-header" :id="`relay-webhook-heading-${index}`">
              <button
                class="accordion-button collapsed"
                type="button"
                data-bs-toggle="collapse"
                :data-bs-target="`#relay-webhook-body-${index}`"
                aria-expanded="false"
                :aria-controls="`relay-webhook-body-${index}`"
              >
                <span class="badge me-3" :class="log.success ? 'text-bg-success' : 'text-bg-danger'">
                  [[ log.success ? '成功' : '失敗' ]]
                </span>
                <span class="badge text-bg-secondary me-3">[[ log.event ]]</span>
                <span class="me-3 fw-semibold text-break">[[ log.url ]]</span>
                <span class="text-muted small">HTTP [[ log.statusCode !== null && log.statusCode !== undefined ? log.statusCode : '-' ]]</span>
                <span class="text-muted small ms-3">[[ log.timestamp ]]</span>
              </button>
            </h2>
            <div
              :id="`relay-webhook-body-${index}`"
              class="accordion-collapse collapse"
              :aria-labelledby="`relay-webhook-heading-${index}`"
              data-bs-parent="#relayWebhookLogs"
            >
              <div class="accordion-body">
                <dl class="row mb-0">
                  <dt class="col-sm-3">Job ID</dt>
                  <dd class="col-sm-9 text-break">[[ log.jobId ]]</dd>
                  <dt class="col-sm-3">Order ID</dt>
                  <dd class="col-sm-9 text-break">[[ log.orderId ]]</dd>
                  <dt class="col-sm-3">Authorization</dt>
                  <dd class="col-sm-9">[[ log.authorization ? 'Bearer ' + log.authorization : '(なし)' ]]</dd>
                  <dt class="col-sm-3">ペイロード</dt>
                  <dd class="col-sm-9"><pre class="bg-light p-3 rounded">[[ log.payload ]]</pre></dd>
                  <dt class="col-sm-3">応答</dt>
                  <dd class="col-sm-9"><pre class="bg-light p-3 rounded">[[ log.responseText || '(なし)' ]]</pre></dd>
                  <dt class="col-sm-3">エラー</dt>
                  <dd class="col-sm-9"><pre class="bg-light p-3 rounded">[[ log.error || '(なし)' ]]</pre></dd>
                </dl>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="card shadow-sm mt-4">
      <div class="card-header bg-white d-flex justify-content-between align-items-center">
        <h2 class="h5 mb-0">Gemini リクエスト履歴</h2>
        <span class="text-muted small">最大 10 件を表示</span>
      </div>
      <div class="card-body">
        <p class="text-muted mb-0" v-if="!state.geminiLogs.length">履歴はまだありません。</p>
        <div class="accordion" id="geminiLogs" v-else>
          <div
            class="accordion-item"
            v-for="(log, index) in state.geminiLogs"
            :key="`gemini-${log.id}`"
          >
            <h2 class="accordion-header" :id="`gemini-heading-${index}`">
              <button
                class="accordion-button collapsed"
                type="button"
                data-bs-toggle="collapse"
                :data-bs-target="`#gemini-body-${index}`"
                aria-expanded="false"
                :aria-controls="`gemini-body-${index}`"
              >
                <span class="badge me-3" :class="log.success ? 'text-bg-success' : 'text-bg-danger'">
                  [[ log.success ? '成功' : '失敗' ]]
                </span>
                <span class="badge text-bg-secondary me-3">[[ log.sourceLabel ]]</span>
                <span class="badge text-bg-info me-3" v-if="log.workerName">[[ log.workerName ]]</span>
                <span class="me-3 fw-semibold">[[ log.model ]]</span>
                <span class="me-3 text-muted">[[ log.mimeType ]]</span>
                <span class="text-muted small">[[ log.timestamp ]]</span>
              </button>
            </h2>
            <div
              :id="`gemini-body-${index}`"
              class="accordion-collapse collapse"
              :aria-labelledby="`gemini-heading-${index}`"
              data-bs-parent="#geminiLogs"
              >
                <div class="accordion-body">
                  <dl class="row mb-0">
                    <dt class="col-sm-3">ソース</dt>
                    <dd class="col-sm-9">[[ log.source ]]</dd>
                    <dt class="col-sm-3">ワーカー</dt>
                    <dd class="col-sm-9">[[ log.workerName || '-' ]]</dd>
                    <dt class="col-sm-3">プロンプト</dt>
                    <dd class="col-sm-9">[[ log.promptPreview ]]</dd>
                    <dt class="col-sm-3">リクエスト</dt>
                    <dd class="col-sm-9"><pre class="bg-light p-3 rounded">[[ formatJson(log.request) ]]</pre></dd>
                    <dt class="col-sm-3">テキスト</dt>
                    <dd class="col-sm-9"><pre class="bg-light p-3 rounded">[[ log.responseText || '(なし)' ]]</pre></dd>
                    <dt class="col-sm-3">メタ情報</dt>
                    <dd class="col-sm-9"><pre class="bg-light p-3 rounded">[[ formatJson(log.meta) ]]</pre></dd>
                    <dt class="col-sm-3">エラー</dt>
                  <dd class="col-sm-9"><pre class="bg-light p-3 rounded">[[ log.error || '(なし)' ]]</pre></dd>
                </dl>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="card shadow-sm mt-4 mb-5">
      <div class="card-header bg-white d-flex justify-content-between align-items-center">
        <h2 class="h5 mb-0">Webhook 履歴</h2>
        <span class="text-muted small">最大 10 件を表示</span>
      </div>
      <div class="card-body">
        <p class="text-muted mb-0" v-if="!state.webhookLogs.length">履歴はまだありません。</p>
        <div class="accordion" id="webhookLogs" v-else>
          <div
            class="accordion-item"
            v-for="(log, index) in state.webhookLogs"
            :key="`webhook-${index}`"
          >
            <h2 class="accordion-header" :id="`webhook-heading-${index}`">
              <button
                class="accordion-button collapsed"
                type="button"
                data-bs-toggle="collapse"
                :data-bs-target="`#webhook-body-${index}`"
                aria-expanded="false"
                :aria-controls="`webhook-body-${index}`"
              >
                <span class="badge me-3" :class="log.success ? 'text-bg-success' : 'text-bg-danger'">
                  [[ log.success ? '成功' : '失敗' ]]
                </span>
                <span class="me-3 fw-semibold text-break">[[ log.url ]]</span>
                <span class="text-muted small">HTTP [[ log.statusCode !== null && log.statusCode !== undefined ? log.statusCode : '-' ]]</span>
                <span class="text-muted small ms-3">[[ log.timestamp ]]</span>
              </button>
            </h2>
            <div
              :id="`webhook-body-${index}`"
              class="accordion-collapse collapse"
              :aria-labelledby="`webhook-heading-${index}`"
              data-bs-parent="#webhookLogs"
            >
              <div class="accordion-body">
                <dl class="row mb-0">
                  <dt class="col-sm-3">Authorization</dt>
                  <dd class="col-sm-9">[[ log.authorization ? 'Bearer ' + log.authorization : '(なし)' ]]</dd>
                  <dt class="col-sm-3">ペイロード</dt>
                  <dd class="col-sm-9"><pre class="bg-light p-3 rounded">[[ log.payload ]]</pre></dd>
                  <dt class="col-sm-3">応答</dt>
                  <dd class="col-sm-9"><pre class="bg-light p-3 rounded">[[ log.responseText || '(なし)' ]]</pre></dd>
                  <dt class="col-sm-3">エラー</dt>
                  <dd class="col-sm-9"><pre class="bg-light p-3 rounded">[[ log.error || '(なし)' ]]</pre></dd>
                </dl>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const initialState = {{ dashboard | tojson }};

    const app = Vue.createApp({
      data() {
        const settings = {};
        for (const field of initialState.configFields) {
          settings[field.env] = field.value || '';
        }
        return {
          state: initialState,
          forms: {
            settings,
            gemini: {
              prompt: '',
              masters: initialState.defaults.masters,
              model: '',
              temperature:
                initialState.defaults.geminiTemperature !== undefined &&
                initialState.defaults.geminiTemperature !== null
                  ? String(initialState.defaults.geminiTemperature)
                  : '',
              topP:
                initialState.defaults.geminiTopP !== undefined &&
                initialState.defaults.geminiTopP !== null
                  ? String(initialState.defaults.geminiTopP)
                  : '',
              topK: '',
              maxOutputTokens: '',
            },
            webhook: {
              url: initialState.defaults.webhookUrl,
              token: initialState.defaults.webhookToken,
              payload: initialState.defaults.webhookPayload,
            },
          },
          ui: {
            messagesExpanded: true,
          },
        };
      },
      computed: {
        jobPageNumbers() {
          const pagination = this.state.jobsPagination || {};
          const total = pagination.totalPages || 0;
          if (!total || total < 1) {
            return [];
          }
          return Array.from({ length: total }, (_, index) => index + 1);
        },
      },
      methods: {
        formatJson(value) {
          if (!value) {
            return '(なし)';
          }
          try {
            return JSON.stringify(value, null, 2);
          } catch (error) {
            return String(value);
          }
        },
        jobPageLink(page) {
          if (!page || page < 1) {
            return '#';
          }
          const pagination = this.state.jobsPagination || {};
          if (pagination.totalPages && page > pagination.totalPages) {
            return '#';
          }
          const search = new URLSearchParams(window.location.search);
          search.set('job_page', String(page));
          const query = search.toString();
          return query ? `${window.location.pathname}?${query}` : window.location.pathname;
        },
      },
    });

    app.config.compilerOptions.delimiters = ['[[', ']]'];
    app.mount('#app');
  </script>
</body>
</html>
